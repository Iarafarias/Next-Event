# ðŸ§ª Guia de Testes - Next-Event API\n\n## ðŸ“‹ VisÃ£o Geral\n\nEste projeto implementa uma suite completa de testes unitÃ¡rios e de integraÃ§Ã£o para garantir a qualidade e confiabilidade da API Next-Event.\n\n## ðŸ—‚ï¸ Estrutura de Testes\n\n```\ntests/\nâ”œâ”€â”€ setup/\nâ”‚   â””â”€â”€ jest.setup.ts           # ConfiguraÃ§Ã£o global do Jest\nâ”œâ”€â”€ helpers/\nâ”‚   â””â”€â”€ TestDataBuilder.ts      # Builders e mocks para testes\nâ”œâ”€â”€ unit/\nâ”‚   â”œâ”€â”€ application/\nâ”‚   â”‚   â””â”€â”€ user/\nâ”‚   â”‚       â””â”€â”€ BolsistaViewDataUseCase.spec.ts\nâ”‚   â”œâ”€â”€ infrastructure/\nâ”‚   â”‚   â””â”€â”€ aluno/\nâ”‚   â”‚       â””â”€â”€ PostgresAlunoRepository.spec.ts\nâ”‚   â””â”€â”€ presentation/\nâ”‚       â””â”€â”€ aluno/\nâ”‚           â””â”€â”€ AlunoController.spec.ts\nâ””â”€â”€ integration/\n    â””â”€â”€ api/\n        â”œâ”€â”€ aluno/\n        â”‚   â””â”€â”€ alunoRoutes.spec.ts\n        â”œâ”€â”€ bolsista/\n        â”‚   â””â”€â”€ bolsistaRoutes.spec.ts\n        â””â”€â”€ health/\n            â””â”€â”€ healthCheck.spec.ts\n```\n\n## ðŸ› ï¸ ConfiguraÃ§Ã£o\n\n### PrÃ©-requisitos\n\n- Node.js 18+\n- PostgreSQL (para testes de integraÃ§Ã£o)\n- VariÃ¡veis de ambiente configuradas\n\n### VariÃ¡veis de Ambiente para Testes\n\nCrie um arquivo `.env.test` (opcional) ou configure:\n\n```bash\nDATABASE_TEST_URL=\"postgresql://postgres:password@localhost:5432/nextevent_test\"\n```\n\n### ConfiguraÃ§Ã£o do Jest\n\nO Jest estÃ¡ configurado com:\n\n- **Preset**: `ts-jest` para suporte TypeScript\n- **Environment**: `node` para APIs Node.js\n- **Setup**: ConfiguraÃ§Ã£o automÃ¡tica de banco e mocks\n- **Projects**: SeparaÃ§Ã£o entre unit e integration tests\n- **Coverage**: RelatÃ³rios de cobertura detalhados\n\n## ðŸš€ Executando os Testes\n\n### Comandos Principais\n\n```bash\n# Todos os testes\nnpm test\n\n# Apenas testes unitÃ¡rios\nnpm run test:unit\n\n# Apenas testes de integraÃ§Ã£o\nnpm run test:integration\n\n# Testes com cobertura\nnpm run test:coverage\n\n# Modo watch (desenvolvimento)\nnpm run test:watch\n\n# CI/CD (sem watch)\nnpm run test:ci\n```\n\n### Executando Testes EspecÃ­ficos\n\n```bash\n# Testes de um arquivo especÃ­fico\nnpm test -- AlunoController.spec.ts\n\n# Testes com padrÃ£o no nome\nnpm test -- --testNamePattern=\"deve criar\"\n\n# Testes de um diretÃ³rio\nnpm test -- tests/unit/application/\n```\n\n## ðŸŽ¯ Tipos de Testes\n\n### 1. Testes UnitÃ¡rios\n\n**LocalizaÃ§Ã£o**: `tests/unit/`\n\n**Objetivo**: Testar componentes isoladamente\n\n**Cobertura**:\n- âœ… Use Cases (lÃ³gica de negÃ³cio)\n- âœ… Controllers (handlers HTTP)\n- âœ… Repositories (acesso a dados)\n- âœ… Entities (domÃ­nio)\n\n**Exemplo**:\n```typescript\ndescribe('CreateAlunoUseCase', () => {\n  let useCase: CreateAlunoUseCase;\n  let mockRepository: jest.Mocked<IAlunoRepository>;\n\n  beforeEach(() => {\n    mockRepository = MockFactory.createAlunoRepositoryMock();\n    useCase = new CreateAlunoUseCase(mockRepository);\n  });\n\n  it('deve criar aluno com dados vÃ¡lidos', async () => {\n    // Arrange, Act, Assert\n  });\n});\n```\n\n### 2. Testes de IntegraÃ§Ã£o\n\n**LocalizaÃ§Ã£o**: `tests/integration/`\n\n**Objetivo**: Testar fluxos completos da API\n\n**Cobertura**:\n- âœ… Endpoints HTTP\n- âœ… Banco de dados real\n- âœ… Middleware de autenticaÃ§Ã£o\n- âœ… ValidaÃ§Ãµes de entrada\n- âœ… Respostas completas\n\n**Exemplo**:\n```typescript\ndescribe('Aluno API', () => {\n  beforeEach(async () => {\n    await cleanDatabase();\n    await seedTestData();\n  });\n\n  it('POST /api/alunos - deve criar aluno', async () => {\n    const response = await request(app)\n      .post('/api/alunos')\n      .set('Authorization', authToken)\n      .send(alunoData)\n      .expect(201);\n    \n    expect(response.body.data).toHaveProperty('id');\n  });\n});\n```\n\n## ðŸ§° UtilitÃ¡rios de Teste\n\n### TestDataBuilder\n\nClasse para criar dados de teste consistentes:\n\n```typescript\n// Criar entidades de teste\nconst usuario = TestDataBuilder.createUsuario();\nconst curso = TestDataBuilder.createCurso();\nconst aluno = TestDataBuilder.createAluno({\n  usuarioId: usuario.id,\n  cursoId: curso.id\n});\n\n// Criar mocks de repository\nconst mockRepo = MockFactory.createAlunoRepositoryMock();\n\n// Criar mocks Express\nconst req = ExpressMocks.createMockRequest();\nconst res = ExpressMocks.createMockResponse();\n```\n\n### Setup AutomÃ¡tico\n\nO `jest.setup.ts` configura automaticamente:\n- ConexÃ£o com banco de teste\n- Limpeza entre testes\n- Mocks de console\n- VariÃ¡veis globais\n\n## ðŸ“Š Cobertura de CÃ³digo\n\n### RelatÃ³rios de Cobertura\n\n```bash\n# Gerar relatÃ³rio de cobertura\nnpm run test:coverage\n\n# Abrir relatÃ³rio HTML\nopen coverage/lcov-report/index.html\n```\n\n### Metas de Cobertura\n\n- **Statements**: 80%+\n- **Branches**: 75%+\n- **Functions**: 85%+\n- **Lines**: 80%+\n\n### Arquivos ExcluÃ­dos\n\n- `src/main.ts` (bootstrap)\n- `src/**/*Config.ts` (configuraÃ§Ã£o)\n- `src/infrastructure/database/**` (Prisma generated)\n- `src/**/*.d.ts` (type definitions)\n\n## ðŸ”§ Melhores PrÃ¡ticas\n\n### Estrutura de Teste\n\n```typescript\ndescribe('ComponentName', () => {\n  // Setup\n  let component: ComponentType;\n  let dependencies: MockType;\n\n  beforeEach(() => {\n    // Initialize for each test\n  });\n\n  describe('methodName', () => {\n    it('deve comportamento esperado quando condiÃ§Ã£o', async () => {\n      // Arrange\n      const input = createTestData();\n      \n      // Act\n      const result = await component.method(input);\n      \n      // Assert\n      expect(result).toEqual(expectedOutput);\n      expect(mockDependency).toHaveBeenCalledWith(expected);\n    });\n  });\n});\n```\n\n### Naming Conventions\n\n- **Describes**: Nome do componente/mÃ©todo sendo testado\n- **Its**: \"deve [comportamento] quando [condiÃ§Ã£o]\"\n- **VariÃ¡veis**: Nomes descritivos e em portuguÃªs\n- **Files**: `ComponentName.spec.ts`\n\n### Isolamento de Testes\n\n```typescript\n// âœ… Bom - cada teste independente\nbeforeEach(() => {\n  mockRepo.reset();\n});\n\n// âŒ Evitar - estado compartilhado\nconst sharedData = { /* ... */ };\n```\n\n### Dados de Teste\n\n```typescript\n// âœ… Usar builders\nconst aluno = TestDataBuilder.createAluno({\n  tipoAcesso: TipoAcessoAluno.ACESSO_TUTOR\n});\n\n// âŒ Dados hardcoded\nconst aluno = {\n  id: 'aluno-123',\n  nome: 'JoÃ£o Silva',\n  // ...\n};\n```\n\n## ðŸš¨ SoluÃ§Ã£o de Problemas\n\n### Problemas Comuns\n\n#### 1. Timeout nos testes\n```bash\n# Aumentar timeout no jest.config.js\ntestTimeout: 15000\n\n# Ou por teste\nit('teste longo', async () => {\n  // ...\n}, 20000);\n```\n\n#### 2. Banco de dados nÃ£o encontrado\n```bash\n# Verificar se PostgreSQL estÃ¡ rodando\npsql -U postgres\n\n# Criar banco de teste\nCREATE DATABASE nextevent_test;\n```\n\n#### 3. Tipos Jest nÃ£o encontrados\n```bash\n# Verificar se @types/jest estÃ¡ instalado\nnpm install --save-dev @types/jest\n\n# Restart TypeScript server no VS Code\nCtrl+Shift+P â†’ \"TypeScript: Restart TS Server\"\n```\n\n### Debugging\n\n```typescript\n// Debug especÃ­fico\nit.only('teste especÃ­fico', () => {\n  // SÃ³ este teste rodarÃ¡\n});\n\n// Skip temporÃ¡rio\nit.skip('teste com problema', () => {\n  // Teste serÃ¡ ignorado\n});\n\n// Debug com console\nit('teste debug', () => {\n  console.log('Debug info:', data);\n  expect(data).toBeDefined();\n});\n```\n\n## ðŸ“ˆ MÃ©tricas e Monitoramento\n\n### CI/CD Integration\n\n```bash\n# No pipeline de CI\nnpm run test:ci\n\n# Com reporting para Sonar/CodeCov\nnpm run test:coverage -- --coverageReporters=lcov\n```\n\n### Performance dos Testes\n\n```bash\n# Executar com verbose para timings\nnpm test -- --verbose\n\n# Detectar testes lentos\nnpm test -- --detectSlowTests\n```\n\n## ðŸ“š Recursos Adicionais\n\n- [Jest Documentation](https://jestjs.io/docs/getting-started)\n- [Supertest Guide](https://github.com/visionmedia/supertest)\n- [Testing Node.js Applications](https://nodejs.org/en/docs/guides/testing/)\n- [Prisma Testing Guide](https://www.prisma.io/docs/guides/testing)\n\n---\n\n**Status**: âœ… Suite de testes completa implementada\n\n**Ãšltima atualizaÃ§Ã£o**: Janeiro 2026\n