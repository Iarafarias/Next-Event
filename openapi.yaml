openapi: 3.0.3
info:
  title: Next-Event API
  description: API REST para gerenciamento de usuários, certificados, relatórios e papéis (Coordenador, Tutor, Bolsista).
  version: 1.0.0
servers:
  - url: http://localhost:3000/api
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Certificate:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        title:
          type: string
        description:
          type: string
        institution:
          type: string
        workload:
          type: integer
        status:
          type: string
          enum: [pending, approved, rejected]
        certificateUrl:
          type: string
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
        adminComments:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
paths:
  /users/login:
    post:
      summary: Autentica usuário e retorna token JWT
      tags: ["Autenticacao"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                senha:
                  type: string
              required:
                - email
                - senha
      responses:
        '200':
          description: Login realizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  usuario:
                    type: object
                    properties:
                      id:
                        type: string
                      nome:
                        type: string
                      email:
                        type: string
                      status:
                        type: string
                      role:
                        type: string
                      aluno:
                        type: object
                        properties:
                          matricula:
                            type: string
                          role:
                            type: string
                      criadoEm:
                        type: string
                        format: date-time
                      atualizadoEm:
                        type: string
                        format: date-time
        '401':
          description: Credenciais inválidas

  /users:
    post:
      summary: Cria um novo usuário
      tags: ["Usuarios"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome:
                  type: string
                email:
                  type: string
                senha:
                  type: string
                status:
                  type: string
                  enum: [ATIVO, INATIVO, PENDENTE]
                aluno:
                  type: object
                  description: Dados do perfil de aluno (criado automaticamente para todos os usuários)
                  properties:
                    cursoId:
                      type: string
                      description: ID do curso para vincular o aluno
                    matricula:
                      type: string
                      description: Número de matrícula do aluno
                coordenador:
                  type: object
                  description: Dados do perfil de coordenador (opcional)
                  properties:
                    area:
                      type: string
                    nivel:
                      type: string
                tutor:
                  type: object
                  description: Dados do perfil de tutor (opcional)
                  properties:
                    area:
                      type: string
                    nivel:
                      type: string
                    capacidadeMaxima:
                      type: integer
                bolsista:
                  type: object
                  description: Dados do perfil de bolsista (opcional)
                  properties:
                    anoIngresso:
                      type: integer
                    curso:
                      type: string
              required:
                - nome
                - email
                - senha
      responses:
        '201':
          description: Usuário criado com sucesso
        '400':
          description: Dados inválidos
    get:
      summary: Lista todos os usuários
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de usuários
        '401':
          description: Token não fornecido ou inválido
        '403':
          description: Acesso negado (apenas admins)

  /users/{id}:
    get:
      summary: Busca usuário por ID
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Usuário encontrado
        '404':
          description: Usuário não encontrado
    put:
      summary: Atualiza usuário por ID
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome:
                  type: string
                email:
                  type: string
                senha:
                  type: string
                matricula:
                  type: string
                cpf:
                  type: string
                status:
                  type: string
                  enum: [ATIVO, INATIVO, PENDENTE]
      responses:
        '200':
          description: Usuário atualizado
        '404':
          description: Usuário não encontrado
    delete:
      summary: Remove usuário por ID
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Usuário removido
        '404':
          description: Usuário não encontrado
  /users/coordenadores:
    get:
      summary: Lista todos os coordenadores
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de coordenadores
  /users/tutores:
    get:
      summary: Lista todos os tutores
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de tutores
  /users/bolsistas:
    get:
      summary: Lista todos os bolsistas
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de bolsistas
  /coordenadores/{id}/certificados:
    get:
      summary: Lista certificados de um coordenador
      tags: ["Certificados"]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lista de certificados
  /tutores/{id}/certificados:
    get:
      summary: Lista certificados de um tutor
      tags: ["Certificados"]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lista de certificados
  /bolsistas/{id}/certificados:
    get:
      summary: Lista certificados de um bolsista
      tags: ["Certificados"]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lista de certificados
  /coordenadores/{id}/validar-certificado:
    post:
      summary: Coordenador valida certificado
      tags: ["Certificados"]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                certificateId:
                  type: string
      responses:
        '200':
          description: Certificado validado
  /tutores/{id}/emitir-certificado:
    post:
      summary: Tutor emite certificado
      tags: ["Certificados"]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                certificateId:
                  type: string
      responses:
        '200':
          description: Certificado emitido
  /bolsistas/{id}/solicitar-certificado:
    post:
      summary: Bolsista solicita certificado
      tags: ["Certificados"]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                certificateId:
                  type: string
      responses:
        '200':
          description: Certificado solicitado
  /users/{id}/atribuir-papel:
    patch:
      summary: Atribui ou remove papel de usuário
      tags: ["Usuarios"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                papel:
                  type: string
      responses:
        '200':
          description: Papel atribuído/removido
  /coordenadores/{id}/relatorios:
    get:
      summary: Lista relatórios sob responsabilidade do coordenador
      tags: [Relatórios]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lista de relatórios
  /tutores/{id}/relatorios:
    get:
      summary: Lista relatórios sob responsabilidade do tutor
      tags: [Relatórios]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lista de relatórios
  /bolsistas/{id}/relatorios:
    get:
      summary: Lista relatórios sob responsabilidade do bolsista
      tags: [Relatórios]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lista de relatórios

  /certificates/reference-month:
    get:
      summary: Recupera o mês de referência atual para upload de certificados
      tags: ["Configuracoes"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Mês de referência recuperado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  reference:
                    type: object
                    properties:
                      month:
                        type: integer
                      year:
                        type: integer
        '404':
          description: Nenhum mês de referência configurado
    post:
      summary: Define o mês de referência para upload de certificados
      tags: ["Configuracoes"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                month:
                  type: integer
                  description: Mês (1-12)
                year:
                  type: integer
                  description: Ano (ex. 2024)
              required:
                - month
                - year
      responses:
        '200':
          description: Mês de referência definido com sucesso
        '400':
          description: Dados inválidos
        '403':
          description: Acesso negado (apenas coordenadores e admins)

  /certificates/upload:
    post:
      summary: Realiza o upload de um certificado em PDF
      tags: ["Certificados"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                certificate:
                  type: string
                  format: binary
                  description: Arquivo PDF do certificado
                title:
                  type: string
                description:
                  type: string
                institution:
                  type: string
                workload:
                  type: integer
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
      responses:
        '201':
          description: Certificado enviado com sucesso
        '400':
          description: Falha na validação ou processamento do PDF

  /certificates/user/{userId}:
    get:
      summary: Lista certificados de um usuário específico
      tags: ["Certificados"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lista de certificados retornada
          content:
            application/json:
              schema:
                type: object
                properties:
                  certificates:
                    type: array
                    items:
                      $ref: '#/components/schemas/Certificate'

  /certificates/{id}/status:
    patch:
      summary: Atualiza o status de um certificado (aprovar/rejeitar)
      tags: ["Certificados"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [approved, rejected]
                adminComments:
                  type: string
              required:
                - status
      responses:
        '200':
          description: Status atualizado com sucesso
        '403':
          description: Acesso negado (apenas admins)

  /certificates/{id}:
    delete:
      summary: Remove um certificado
      tags: ["Certificados"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Certificado removido com sucesso

  /certificates/{id}/download:
    get:
      summary: Baixa o arquivo PDF de um certificado
      tags: ["Certificados"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Download iniciado
          content:
            application/pdf:
              schema:
                type: string
                format: binary

  /certificates/report:
    get:
      summary: Gera relatório de horas do aluno logado
      tags: ["Certificados"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Relatório gerado

  /periodo-tutoria:
    get:
      summary: Lista todos os períodos de tutoria
      tags: ["Coordenacao"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de períodos
    post:
      summary: Cria um novo período de tutoria
      tags: ["Coordenacao"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome:
                  type: string
                dataInicio:
                  type: string
                  format: date-time
                dataFim:
                  type: string
                  format: date-time
              required:
                - nome
                - dataInicio
                - dataFim
      responses:
        '201':
          description: Período criado com sucesso

  /alocar-tutor-aluno:
    get:
      summary: Lista todas as alocações tutor-aluno
      tags: ["Coordenacao"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de alocações
    post:
      summary: Cria uma nova alocação tutor-aluno
      tags: ["Coordenacao"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tutorId:
                  type: string
                bolsistaId:
                  type: string
                periodoId:
                  type: string
                dataInicio:
                  type: string
                  format: date-time
                dataFim:
                  type: string
                  format: date-time
              required:
                - tutorId
                - bolsistaId
                - periodoId
                - dataInicio
      responses:
        '201':
          description: Alocação criada com sucesso

  /carga-horaria-minima:
    get:
      summary: Lista todas as regras de carga horária mínima
      tags: ["Coordenacao"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de regras
    post:
      summary: Define uma nova regra de carga horária mínima
      tags: ["Coordenacao"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                periodoId:
                  type: string
                categoria:
                  type: string
                  enum: [EVENTOS, MONITORIA, ESTUDOS_INDIVIDUAIS]
                horasMinimas:
                  type: integer
              required:
                - periodoId
                - categoria
                - horasMinimas
      responses:
        '201':
          description: Regra criada com sucesso

  /cursos:
    post:
      summary: Criar um novo curso
      tags: ["Cursos"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome:
                  type: string
                  description: Nome do curso
                codigo:
                  type: string
                  description: Código único do curso
                descricao:
                  type: string
                  description: Descrição do curso (opcional)
              required:
                - nome
                - codigo
      responses:
        '201':
          description: Curso criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  nome:
                    type: string
                  codigo:
                    type: string
                  descricao:
                    type: string
                  criadoEm:
                    type: string
                    format: date-time
                  alunosCount:
                    type: integer
        '400':
          description: Dados inválidos ou código duplicado
        '401':
          description: Não autenticado
        '403':
          description: Sem permissão (requer coordinator ou scholarship_holder)
    get:
      summary: Listar todos os cursos
      tags: ["Cursos"]
      responses:
        '200':
          description: Lista de cursos
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    nome:
                      type: string
                    codigo:
                      type: string
                    descricao:
                      type: string
                    criadoEm:
                      type: string
                      format: date-time
                    alunosCount:
                      type: integer
        '401':
          description: Não autenticado

  /cursos/{id}:
    get:
      summary: Buscar curso por ID
      tags: ["Cursos"]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Curso encontrado
        '404':
          description: Curso não encontrado
    put:
      summary: Atualizar curso
      tags: ["Cursos"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome:
                  type: string
                codigo:
                  type: string
                descricao:
                  type: string
      responses:
        '200':
          description: Curso atualizado
        '400':
          description: Dados inválidos ou código duplicado
        '403':
          description: Sem permissão (requer coordinator ou scholarship_holder)
        '404':
          description: Curso não encontrado
    delete:
      summary: Deletar curso
      tags: ["Cursos"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Curso deletado
        '400':
          description: Não é possível deletar curso com alunos vinculados
        '403':
          description: Sem permissão (requer coordinator)
        '404':
          description: Curso não encontrado

  /alunos:
    get:
      summary: Listar alunos (com filtros opcionais)
      tags: ["Alunos"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: cursoId
          schema:
            type: string
          description: Filtrar por ID do curso
        - in: query
          name: role
          schema:
            type: string
            enum: [ALUNO, TUTOR, BOLSISTA, TUTOR_BOLSISTA]
          description: Filtrar por role do aluno
      responses:
        '200':
          description: Lista de alunos
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    usuarioId:
                      type: string
                    cursoId:
                      type: string
                    matricula:
                      type: string
                    role:
                      type: string
                      enum: [ALUNO, TUTOR, BOLSISTA, TUTOR_BOLSISTA]
                    usuario:
                      type: object
                      properties:
                        id:
                          type: string
                        nome:
                          type: string
                        email:
                          type: string
                    curso:
                      type: object
                      properties:
                        id:
                          type: string
                        nome:
                          type: string
                        codigo:
                          type: string
        '401':
          description: Não autenticado
        '403':
          description: Sem permissão (requer coordinator, tutor ou scholarship_holder)

  /alunos/{id}:
    get:
      summary: Buscar aluno por ID
      tags: ["Alunos"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Aluno encontrado
        '404':
          description: Aluno não encontrado
    put:
      summary: Atualizar dados do aluno
      tags: ["Alunos"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cursoId:
                  type: string
                  description: ID do curso para vincular o aluno
                matricula:
                  type: string
                  description: Número de matrícula do aluno
      responses:
        '200':
          description: Aluno atualizado
        '400':
          description: Dados inválidos
        '403':
          description: Sem permissão (requer coordinator ou scholarship_holder)
        '404':
          description: Aluno não encontrado
